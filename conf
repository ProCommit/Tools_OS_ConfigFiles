" ===== COC.NVIM Configuration - VSCode Style =====
" הוסף את זה ל-~/.config/nvim/init.vim או ~/.vimrc

" התקנת coc.nvim (דרך vim-plug):
" Plug 'neoclide/coc.nvim', {'branch': 'release'}

" ===== הגדרות בסיסיות =====
set hidden
set nobackup
set nowritebackup
set updatetime=300
set shortmess+=c
set signcolumn=yes

" סגירה אוטומטית של תיבת ההשלמות
set completeopt=menu,menuone,noselect

" ===== Auto-complete (כמו VSCode IntelliSense) =====
" Tab לניווט בהשלמות
inoremap <silent><expr> <TAB>
      \ coc#pum#visible() ? coc#pum#next(1) :
      \ CheckBackspace() ? "\<Tab>" :
      \ coc#refresh()
inoremap <expr><S-TAB> coc#pum#visible() ? coc#pum#prev(1) : "\<C-h>"

" Enter - רק משלים אם בחרת במפורש, אחרת סוגר את התיבה ועושה שורה חדשה
inoremap <silent><expr> <CR> coc#pum#visible() ? coc#pum#cancel() . "\<CR>" : "\<C-g>u\<CR>\<c-r>=coc#on_enter()\<CR>"

" Ctrl+Y או Ctrl+Enter - אישור מפורש של ההשלמה הנבחרת
inoremap <silent><expr> <C-y> coc#pum#visible() ? coc#pum#confirm() : "\<C-y>"
inoremap <silent><expr> <C-CR> coc#pum#visible() ? coc#pum#confirm() : "\<CR>"

" Escape - סוגר את תיבת ההשלמות
inoremap <silent><expr> <Esc> coc#pum#visible() ? coc#pum#cancel() : "\<Esc>"

function! CheckBackspace() abort
  let col = col('.') - 1
  return !col || getline('.')[col - 1]  =~# '\s'
endfunc

" Ctrl+Space להצגת השלמות (כמו VSCode)
inoremap <silent><expr> <c-space> coc#refresh()

" ===== ניווט קוד (Go To Definition וכו') =====
" F12 - Go to Definition (כמו VSCode)
nmap <silent> <F12> <Plug>(coc-definition)
nmap <silent> gd <Plug>(coc-definition)

" Ctrl+F12 - Go to Implementation
nmap <silent> <C-F12> <Plug>(coc-implementation)
nmap <silent> gi <Plug>(coc-implementation)

" Shift+F12 - Find All References
nmap <silent> <S-F12> <Plug>(coc-references)
nmap <silent> gr <Plug>(coc-references)

" Alt+F12 - Peek Definition (VSCode style)
nmap <silent> <M-F12> :call CocAction('jumpDefinition', 'vsplit')<CR>

" Go to Type Definition
nmap <silent> gy <Plug>(coc-type-definition)

" ===== Refactoring =====
" F2 - Rename Symbol (כמו VSCode)
nmap <F2> <Plug>(coc-rename)

" Ctrl+. - Code Actions (Quick Fix)
nmap <silent> <C-.> <Plug>(coc-codeaction-cursor)
xmap <silent> <C-.> <Plug>(coc-codeaction-selected)
nmap <silent> <leader>ca <Plug>(coc-codeaction-cursor)

" Alt+Shift+F - Format Document
nmap <silent> <M-S-f> :call CocAction('format')<CR>
vmap <silent> <M-S-f> <Plug>(coc-format-selected)

" ===== תיעוד והצגת מידע =====
" K - Show Documentation (hover)
nnoremap <silent> K :call ShowDocumentation()<CR>

function! ShowDocumentation()
  if CocAction('hasProvider', 'hover')
    call CocActionAsync('doHover')
  else
    call feedkeys('K', 'in')
  endif
endfunc

" Ctrl+Shift+Space - Show Signature Help
inoremap <silent> <C-S-Space> <C-r>=CocActionAsync('showSignatureHelp')<CR>

" ===== Diagnostics (Errors & Warnings) =====
" F8 - Next Diagnostic
nmap <silent> <F8> <Plug>(coc-diagnostic-next)

" Shift+F8 - Previous Diagnostic
nmap <silent> <S-F8> <Plug>(coc-diagnostic-prev)

" Ctrl+Shift+M - Show All Diagnostics (Problems Panel)
nnoremap <silent> <C-S-m> :CocList diagnostics<CR>

" ===== Explorer (File Browser) =====
" Ctrl+Shift+E - Toggle Explorer (כמו VSCode Sidebar)
nnoremap <silent> <C-S-e> :CocCommand explorer<CR>

" ===== Search & Navigation =====
" Ctrl+P - Quick Open File
nnoremap <silent> <C-p> :CocList files<CR>

" Ctrl+Shift+P - Command Palette
nnoremap <silent> <C-S-p> :CocList commands<CR>

" Ctrl+Shift+O - Go to Symbol in File
nnoremap <silent> <C-S-o> :CocList outline<CR>

" Ctrl+T - Go to Symbol in Workspace
nnoremap <silent> <C-t> :CocList symbols<CR>

" ===== Code Folding =====
" Ctrl+Shift+[ - Fold
nnoremap <silent> <C-S-[> :call CocAction('fold')<CR>

" Ctrl+Shift+] - Unfold
nnoremap <silent> <C-S-]> :call CocAction('unfold')<CR>

" ===== Multi-Cursor (Selection) =====
" Ctrl+D - Add Selection to Next Find Match
nmap <silent> <C-d> <Plug>(coc-cursors-word)
xmap <silent> <C-d> <Plug>(coc-cursors-range)

" ===== Code Lens =====
" הצגת Code Lens אוטומטית
autocmd CursorHold * silent call CocActionAsync('highlight')

" ===== Extensions מומלצות =====
" התקן דרך :CocInstall
" :CocInstall coc-json coc-tsserver coc-eslint coc-prettier
" :CocInstall coc-python coc-rust-analyzer coc-go
" :CocInstall coc-explorer coc-snippets

" ===== הגדרות נוספות =====
" הדגשת סימבול נוכחי
autocmd CursorHold * silent call CocActionAsync('highlight')

" Scroll בחלון הצף
nnoremap <silent><nowait><expr> <C-f> coc#float#has_scroll() ? coc#float#scroll(1) : "\<C-f>"
nnoremap <silent><nowait><expr> <C-b> coc#float#has_scroll() ? coc#float#scroll(0) : "\<C-b>"
inoremap <silent><nowait><expr> <C-f> coc#float#has_scroll() ? "\<c-r>=coc#float#scroll(1)\<cr>" : "\<Right>"
inoremap <silent><nowait><expr> <C-b> coc#float#has_scroll() ? "\<c-r>=coc#float#scroll(0)\<cr>" : "\<Left>"
vnoremap <silent><nowait><expr> <C-f> coc#float#has_scroll() ? coc#float#scroll(1) : "\<C-f>"
vnoremap <silent><nowait><expr> <C-b> coc#float#has_scroll() ? coc#float#scroll(0) : "\<C-b>"

" הו
