" =======================================
" COC - VSCode-like smart completion
" =======================================

" Let Coc trigger suggestions automatically when appropriate
let g:coc_enable_auto_trigger = 1

" Popup menu settings
set completeopt=menu,menuone,noinsert,noselect

" --- Completion keymaps ---

" Tab → if menu open, move to next item; otherwise trigger suggestions
inoremap <silent><expr> <Tab>
      \ coc#pum#visible() ? coc#pum#next(1) : coc#refresh()

" Shift+Tab → previous item in menu
inoremap <silent><expr> <S-Tab>
      \ coc#pum#visible() ? coc#pum#prev(1) : "\<C-h>"

" Space → always insert a normal space (never confirm)
inoremap <silent><expr> <Space> "\<Space>"

" Ctrl+Space → manually trigger suggestions
inoremap <silent><expr> <C-Space> coc#refresh()

" --- Enter behavior (smart like VSCode) ---
" If popup is visible AND a selection was made manually, confirm it.
" Otherwise, just insert a normal newline.
inoremap <silent><expr> <CR>
      \ coc#pum#visible() && coc#pum#info()['index'] >= 0
      \ ? coc#pum#confirm()
      \ : "\<CR>"

" --- Close popup if it's hanging while typing ---
" (ensures the menu hides automatically when you keep typing)
autocmd TextChangedI * if coc#pum#visible() | call coc#pum#stop() | endif
autocmd CursorMovedI * if coc#pum#visible() | call coc#pum#stop() | endif

" --- LSP keymaps ---
nmap <silent> gd <Plug>(coc-definition)
nmap <silent> gr <Plug>(coc-references)
nmap <silent> K :call CocActionAsync('doHover')<CR>
nmap <leader>rn <Plug>(coc-rename)
nmap <leader>f <Plug>(coc-format)
